# 内容与隐私权限制场景 - 测试用例

## 概述

本文档包含 ZenBound 应用中"内容与隐私权限制"场景功能的完整测试用例和测试步骤。

---

## 测试环境

- **设备**: iPhone 17 模拟器 (iOS 26.2)
- **应用版本**: ZenBound Demo v2
- **测试日期**: 2025-01-XX

---

## 1. UI 渲染测试

### TC-001: 场景入口显示

**前置条件**: 应用已启动，在 Demo 主页面

**测试步骤**:
1. 点击 "12种应用场景" 进入场景列表
2. 向下滑动至 "⚙️ 高级功能" 部分
3. 验证 "内容与隐私权限制" 条目是否显示

**预期结果**:
- ✅ 显示紫色手举图标 (hand.raised.fill)
- ✅ 标题显示 "内容与隐私权限制"
- ✅ 显示 "NEW" 标签
- ✅ 副标题显示 "App Store、媒体内容、系统设置限制"

---

### TC-002: 场景页面结构

**前置条件**: 进入 "内容与隐私权限制" 场景页面

**测试步骤**:
1. 点击场景条目进入详情页
2. 验证页面标题和结构

**预期结果**:
- ✅ 导航标题显示 "内容与隐私权限制"
- ✅ 显示场景描述区域
- ✅ 显示依赖组件列表
- ✅ 显示当前状态卡片 (未启用/已配置项目)

---

## 2. iTunes 与 App Store 购买限制测试

### TC-003: 禁止安装 App 开关

**测试步骤**:
1. 找到 "🛒 iTunes 与 App Store 购买" 区域
2. 点击 "禁止安装 App" 开关

**预期结果**:
- ✅ 开关变为紫色（开启状态）
- ✅ 顶部 "已配置项目" 数字增加 1
- ✅ 日志区域显示 "🛒 禁止安装 App: 开启"

---

### TC-004: 禁止删除 App 开关

**测试步骤**:
1. 点击 "禁止删除 App" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加
- ✅ 日志记录操作

---

### TC-005: 禁止 App 内购买开关

**测试步骤**:
1. 点击 "禁止 App 内购买" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

### TC-006: 购买时需要密码开关

**测试步骤**:
1. 点击 "购买时需要密码" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

### TC-007: App 内容分级选择器

**测试步骤**:
1. 点击 "App 内容分级" 按钮 (初始显示 "无限制")
2. 在弹出菜单中选择 "9+ (9岁以上)"

**预期结果**:
- ✅ 弹出分级选项列表：无限制、4+、9+、12+、17+
- ✅ 选择后按钮文字更新为 "9+ (9岁以上)"
- ✅ 已配置项目数增加
- ✅ 日志显示 "🛒 App 内容分级: 9+ (9岁以上)"

---

## 3. 内容限制测试

### TC-008: 电影内容分级选择器

**测试步骤**:
1. 向下滑动至 "🎬 内容限制" 区域
2. 点击 "电影内容分级" 选择器

**预期结果**:
- ✅ 显示分级选项列表
- ✅ 选择后按钮文字更新

---

### TC-009: 电视节目内容分级选择器

**测试步骤**:
1. 点击 "电视节目内容分级" 选择器

**预期结果**:
- ✅ 显示分级选项列表
- ✅ 选择后按钮文字更新

---

## 4. Siri 限制测试

### TC-010: 禁用 Siri 开关

**测试步骤**:
1. 向下滑动至 "🎤 Siri 限制" 区域
2. 点击 "禁用 Siri" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加
- ✅ 日志记录操作

---

## 5. Game Center 限制测试

### TC-011: 禁止多人游戏开关

**测试步骤**:
1. 向下滑动至 "🎮 Game Center 限制" 区域
2. 点击 "禁止多人游戏" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

### TC-012: 禁止加入朋友开关

**测试步骤**:
1. 点击 "禁止加入朋友" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

## 6. 系统变更限制测试

### TC-013: 锁定密码开关

**测试步骤**:
1. 向下滑动至 "🔐 系统变更限制" 区域
2. 点击 "锁定密码" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

### TC-014: 锁定帐号开关

**测试步骤**:
1. 点击 "锁定帐号" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

### TC-015: 锁定 App 行动数据开关

**测试步骤**:
1. 点击 "锁定 App 行动数据" 开关

**预期结果**:
- ✅ 开关变为紫色
- ✅ 已配置项目数增加

---

## 7. 操作按钮测试

### TC-016: 应用所有限制按钮

**前置条件**: 已开启至少一个限制开关

**测试步骤**:
1. 向下滑动至 "🚀 操作" 区域
2. 点击紫色 "应用所有限制" 按钮

**预期结果**:
- ✅ 日志显示 "🚀 开始应用所有限制..."
- ✅ 日志显示 "✅ 所有限制已应用成功！共 X 项"
- ✅ 调用 ManagedSettingsStore API

---

### TC-017: 清除所有限制按钮

**测试步骤**:
1. 点击灰色 "清除所有限制" 按钮

**预期结果**:
- ✅ 所有开关重置为关闭状态
- ✅ 已配置项目数变为 0
- ✅ 日志显示清除操作记录

---

### TC-018: 应用儿童安全预设按钮

**测试步骤**:
1. 点击黄色 "应用儿童安全预设" 按钮

**预期结果**:
- ✅ 自动开启适合儿童的限制选项：
  - 禁止安装 App ✅
  - 禁止删除 App ✅
  - 禁止 App 内购买 ✅
  - 购买时需要密码 ✅
  - App 内容分级: 9+
  - 禁用 Siri ✅
  - 禁止多人游戏 ✅
  - 禁止加入朋友 ✅
- ✅ 日志显示 "👶 应用儿童安全预设..."

---

## 8. 日志功能测试

### TC-019: 日志记录

**测试步骤**:
1. 执行多个操作（开关、选择、按钮）
2. 向下滑动至日志区域

**预期结果**:
- ✅ 每条日志显示时间戳
- ✅ 显示操作类型图标（✅/🚀/🛒/ℹ️）
- ✅ 日志按时间倒序排列（最新在上）

---

### TC-020: 清除日志按钮

**测试步骤**:
1. 点击导航栏右上角的垃圾桶图标

**预期结果**:
- ✅ 所有日志被清除
- ✅ 日志区域变空或显示提示

---

## 9. 边界条件测试

### TC-021: 重复开关切换

**测试步骤**:
1. 快速多次点击同一开关

**预期结果**:
- ✅ 开关状态正确切换
- ✅ 计数器正确更新
- ✅ 无 UI 卡顿或崩溃

---

### TC-022: 空状态显示

**前置条件**: 所有限制都未启用

**测试步骤**:
1. 查看状态卡片

**预期结果**:
- ✅ 显示 "未启用 0"
- ✅ 显示 "已配置项目 0"

---

## 10. 集成测试

### TC-023: 与 AppBlockerUtil 集成

**测试步骤**:
1. 应用限制后检查控制台日志

**预期结果**:
- ✅ 调用 `store.appStore.denyInAppPurchases`
- ✅ 调用 `store.application.denyAppInstallation`
- ✅ 调用 `store.application.denyAppRemoval`
- ✅ 调用 `store.siri.denySiri`
- ✅ 调用 `store.gameCenter` 属性
- ✅ 调用 `store.passcode.lockPasscode`

---

## 已验证的测试结果 (Mobile MCP)

| 测试编号 | 测试项目           | 状态   | 备注                 |
| -------- | ------------------ | ------ | -------------------- |
| TC-001   | 场景入口显示       | ✅ PASS | NEW 标签正常显示     |
| TC-002   | 场景页面结构       | ✅ PASS | 所有区域正常渲染     |
| TC-003   | 禁止安装 App 开关  | ✅ PASS | 计数器更新正确       |
| TC-004   | 禁止删除 App 开关  | ✅ PASS | 计数器更新正确       |
| TC-007   | App 内容分级选择器 | ✅ PASS | 9+ 选择成功          |
| TC-016   | 应用所有限制按钮   | ✅ PASS | 日志显示成功         |
| TC-019   | 日志记录           | ✅ PASS | 时间戳和操作记录正确 |

---

## 已知限制

1. **隐私权限 API 不可用**: `store.privacy` 在 ManagedSettings 框架中不存在，相关功能需通过系统设置手动配置。

2. **Siri 限制简化**: ManagedSettings 只提供 `denySiri` 一个开关，不支持单独控制 Siri 网页内容或显式内容过滤。

3. **显式内容过滤**: `store.media` 不包含 `denyExplicitContent` 属性，需通过系统设置配置。

---

## 相关文件

- [ContentPrivacyRestrictionsScenarioView.swift](../ZenBound/DemoUI/Scenarios/ContentPrivacyRestrictionsScenarioView.swift)
- [AppBlockerUtil.swift](../ZenBound/Utils/AppBlockerUtil.swift)
- [ScenariosHomeView.swift](../ZenBound/DemoUI/Scenarios/ScenariosHomeView.swift)
