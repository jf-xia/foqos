# 娱乐组配置 - 实际测试执行指南

**测试设备**: EmilyiPhone (iOS 26.2)  
**应用**: ZenBound  
**测试日期**: 2026-01-26  
**状态**: 🔴 待执行

---

## 🎯 测试前准备

### 1. 确保应用已安装
```bash
# 在Mac上检查安装状态
devices=$(xcrun xctrace list devices 2>/dev/null | grep "00008101-001D48321A00001E")
echo $devices
```

### 2. 打开应用
1. 解锁 iPhone
2. 在主屏找到 **ZenBound** 应用
3. 点击打开

### 3. 允许系统权限
- 如果弹出权限请求，点击 **"允许"**

---

## 📋 测试场景 1: 权限检查

**目标**: 验证应用能正确检查和请求屏幕时间权限

### 执行步骤

1. **打开应用** → ZenBound 主屏
2. **找到 Scenarios 菜单**
   - 点击底部或侧边栏的 "Scenarios" 或 "Demo"
   - 选择 "Entertainment Group Configuration"

3. **观察权限状态**
   - 应该看到 "Step 1: Authorization Check" 的卡片
   - 如果显示 ✅ "Authorized" → 权限已授予，继续
   - 如果显示 ❌ "Not Authorized" → 需要授权

4. **如果未授权，请求权限**
   - 点击 "Request Authorization" 按钮
   - 在系统弹窗中点击 "Allow"
   - 等待返回应用

5. **验证结果**
   - [ ] 权限状态显示为已授予
   - [ ] 日志中出现 "✅ Screen Time authorization successful"
   - [ ] 可以继续到下一步

### 预期结果
```
✅ Authorization Check PASSED
   - 系统弹窗出现并允许
   - 权限状态更新为已授予
   - 日志显示成功信息
```

### 常见问题
- **问题**: 弹窗未出现
  - **解决**: 检查设备是否已解锁，重试请求

- **问题**: 显示 "Denied"
  - **解决**: 进入设备 设置 > 屏幕时间 > 启用，并手动授权

---

## 🎮 测试场景 2: App 选择

**目标**: 验证能够正确选择和显示娱乐应用

### 执行步骤

1. **进入 Step 2: App Selection**
   - 如果权限检查通过，页面会滚动到"App Selection"部分

2. **点击 "Select Entertainment Apps" 按钮**
   - 应该弹出 FamilyActivityPicker 界面

3. **在 App Picker 中选择应用**
   - 找到社交类应用：Instagram、TikTok、Facebook 等
   - 勾选 3-5 个应用
   - 或选择类别：勾选 "Games"、"Social"、"Entertainment"

4. **点击 "Done" 完成选择**

5. **验证选择结果**
   - [ ] 返回配置页面
   - [ ] 显示已选择的应用数量
   - [ ] 日志显示 "✅ Entertainment apps selected: X apps, X categories"

### 预期结果
```
✅ App Selection PASSED
   - FamilyActivityPicker 正常打开
   - 能选择多个应用
   - 选择信息正确显示
   - 日志记录选择
```

### 常见问题
- **问题**: 无法打开 Picker
  - **解决**: 确保权限已授予

- **问题**: 选择后返回时显示为空
  - **解决**: 重试选择，确保完整勾选

---

## ⏰ 测试场景 3: 每小时限制配置

**目标**: 验证每小时时间限制设置正常工作

### 执行步骤

1. **进入 "Hourly Limit Settings" 部分**

2. **确保启用了每小时限制**
   - 检查 "Enable Hourly Limit" 开关为 ON

3. **设置每小时可用时长**
   - 点击下拉菜单选择时长
   - 选择 **15 分钟**（推荐用于测试）

4. **观察可视化显示**
   - 应该显示 15 分钟绿色，45 分钟灰色
   - 下方卡片显示时间分配

5. **验证配置**
   - [ ] 时长选择器工作正常
   - [ ] 每小时时间分配正确（60 = 15 + 45）
   - [ ] 日志显示 "⏱️ Hourly time limit set to 15 minutes"

### 预期结果
```
✅ Hourly Limit Configuration PASSED
   - 设置选择正常工作
   - 可视化显示准确
   - 配置已保存
```

---

## 📅 测试场景 4: 每日限制配置

**目标**: 验证每日总时长限制设置正常工作

### 执行步骤

1. **进入 "Daily Time Limit Settings" 部分**

2. **设置每日总时长限制**
   - 点击下拉菜单
   - 选择 **120 分钟**（2小时，用于测试）

3. **设置单次使用时长限制**
   - 点击下拉菜单
   - 选择 **30 分钟**

4. **观察计算结果**
   - 右侧卡片应显示：
     - "2小时0分" 每日配额
     - "4 次" 可用次数（120÷30）

5. **验证配置**
   - [ ] 时长选择器工作正常
   - [ ] 可用次数计算准确
   - [ ] 日志显示配置信息

### 预期结果
```
✅ Daily Limit Configuration PASSED
   - 时长配置正确
   - 可用次数计算准确
   - 配置已保存
```

---

## ✅ 测试场景 5: 激活配置

**目标**: 验证配置能够正确激活并启动监控

### 执行步骤

1. **滚动到 "Step 4: Activation & Testing" 部分**

2. **检查配置摘要**
   - 应该显示已配置的所有参数
   - 应用选择、时间限制等

3. **点击 "Activate Configuration" 按钮**
   - 按钮应该变成 "Deactivate"
   - 状态卡片显示 "🟢 Active"

4. **观察日志输出**
   - 应该看到多条成功日志
   - 例如：`✅ Entertainment configuration activated`

5. **验证激活**
   - [ ] 按钮状态改变
   - [ ] 状态指示器变为绿色
   - [ ] 日志确认激活成功
   - [ ] 24个小时的监控都启动了

### 预期结果
```
✅ Configuration Activation PASSED
   - 按钮状态正确切换
   - 状态指示器更新
   - 监控成功启动
   - 日志显示 24/24 小时成功
```

### 常见问题
- **问题**: 显示失败消息
  - **解决**: 检查是否选择了应用和设置了时间限制

- **问题**: 部分小时失败
  - **解决**: 这是正常的，系统会自动重试

---

## 📊 测试场景 6: 使用时间模拟

**目标**: 验证时间计数和监控工作正常

### 执行步骤

1. **配置已激活后，进入 "Usage Simulation" 部分**

2. **输入模拟使用时长**
   - 在输入框输入：`5`（代表5分钟）

3. **点击 "Start Usage Simulation" 按钮**

4. **观察时间累计**
   - 日志应该显示：`📊 Usage updated: +5min`
   - 进度条应该移动

5. **多次测试**
   - 再次点击"Add Usage"增加5分钟
   - 重复直到达到 15 分钟（小时限制）

6. **验证限制触发**
   - [ ] 时间累计正确
   - [ ] 达到限制时日志显示 "⚠️ Entertainment limit reached"
   - [ ] 进度条显示 100%

### 预期结果
```
✅ Usage Simulation PASSED
   - 时间累计准确
   - 进度条实时更新
   - 限制触发时有通知
   - 日志记录所有操作
```

---

## 🛡️ 测试场景 7: Shield 显示

**目标**: 验证达到限制时能正确显示 Shield

### 执行步骤

1. **确保已激活配置且达到小时限制**
   - 从场景 6 继续，已累计 15 分钟或以上

2. **打开一个被屏蔽的应用**
   - 选择之前配置中选中的应用（如 Instagram）
   - 轻按打开

3. **观察 Shield 屏蔽界面**
   - 应该看到弹出的 Shield 覆盖层
   - 显示自定义消息（如 "Enjoy your time!"）
   - 显示颜色和样式

4. **测试 Shield 按钮**
   - 点击 "延长使用" 或 "Open Task" 按钮
   - 应该返回 ZenBound 应用

5. **验证 Shield**
   - [ ] Shield 界面正确显示
   - [ ] 消息清晰可见
   - [ ] 按钮可点击
   - [ ] 样式符合主题

### 预期结果
```
✅ Shield Display PASSED
   - Shield 能正确显示
   - 消息和样式正确
   - 按钮功能正常
```

### 常见问题
- **问题**: Shield 未出现
  - **解决**: 检查是否真的达到了限制

- **问题**: 按钮无响应
  - **解决**: 确保配置已激活

---

## 🔄 测试场景 8: 时间重置

**目标**: 验证每小时和每日时间自动重置

### 执行步骤

1. **记录当前时间**
   - 查看顶部状态栏的时间

2. **等待或手动模拟时间变化**
   
   **方法A - 自然等待（1小时）**:
   - 等待到下一个整点
   - 例如现在是 14:35，等到 15:00
   
   **方法B - 系统时间调整（快速测试）**:
   - 进入 设置 > 通用 > 日期与时间
   - 关闭"自动设置"
   - 手动改变时间到下一小时
   - 返回应用查看

3. **检查时间重置**
   - 日志应该显示 "🔄 Hourly usage reset"
   - 使用时间计数应该从 0 开始
   - 进度条应该清空

4. **验证每日重置**
   - 将日期改为明天
   - 检查每日使用时间是否重置

5. **验证重置**
   - [ ] 小时变化时每小时计数重置
   - [ ] 日期变化时每日计数重置
   - [ ] 日志记录重置事件

### 预期结果
```
✅ Time Reset PASSED
   - 小时变化时自动重置
   - 日期变化时自动重置
   - 日志记录重置事件
   - 数据持久化正确
```

---

## 💾 测试场景 9: 数据持久化

**目标**: 验证配置能在应用重启后保持

### 执行步骤

1. **记录当前配置**
   - 注意当前的设置：
     - 每小时限制：15分钟
     - 每日限制：120分钟
     - 使用时间：X分钟

2. **完全关闭应用**
   - 向上滑动ZenBound应用卡片关闭
   - 或使用iPhone设置完全杀死应用

3. **重新打开应用**
   - 点击 ZenBound 图标

4. **导航回娱乐组配置页面**
   - Scenarios → Entertainment Group Configuration

5. **验证配置保持**
   - [ ] 所有设置仍然是之前的值
   - [ ] 已激活的状态保留
   - [ ] 使用时间数据保持
   - [ ] 日志显示"Config loaded successfully"

### 预期结果
```
✅ Data Persistence PASSED
   - 应用重启后配置保留
   - 使用时间数据保持
   - 激活状态恢复
```

### 常见问题
- **问题**: 配置丢失
  - **解决**: 检查 SharedData 是否正确保存

- **问题**: 显示默认值
  - **解决**: 尝试重新保存配置

---

## 📋 测试记录表

在进行测试时，记录以下信息：

```
测试场景: ___________
测试时间: ___________
设备: EmilyiPhone

步骤1: ☐ PASS ☐ FAIL
  发现的问题: _______________________

步骤2: ☐ PASS ☐ FAIL
  发现的问题: _______________________

步骤3: ☐ PASS ☐ FAIL
  发现的问题: _______________________

总体结果: ☐ PASS ☐ FAIL
备注: ___________________________
```

---

## 🎯 总体测试进度

| # | 场景 | 状态 | 日期 | 备注 |
|---|------|------|------|------|
| 1 | 权限检查 | ⏳ 待测 | | |
| 2 | App 选择 | ⏳ 待测 | | |
| 3 | 每小时限制 | ⏳ 待测 | | |
| 4 | 每日限制 | ⏳ 待测 | | |
| 5 | 激活配置 | ⏳ 待测 | | |
| 6 | 使用模拟 | ⏳ 待测 | | |
| 7 | Shield 显示 | ⏳ 待测 | | |
| 8 | 时间重置 | ⏳ 待测 | | |
| 9 | 数据持久化 | ⏳ 待测 | | |

---

## 📝 快速命令参考

### 重新启动应用
```bash
# 终止应用
xcrun simctl terminate booted com.lxt.ZenBound

# 启动应用
xcrun simctl launch booted com.lxt.ZenBound
```

### 查看实时日志
```bash
log stream --predicate 'eventMessage contains[cd] "Entertainment"' --level debug
```

### 清除所有数据
```bash
# 在设置 > 通用 > iPhone存储空间 中找到 ZenBound 并删除
# 或使用 xcrun simctl erase all
```

---

## ✅ 完成后检查清单

测试完毕后，请确认：

- [ ] 所有9个测试场景都已执行
- [ ] 测试结果已记录
- [ ] 发现的所有问题都已列出
- [ ] 拍摄了关键步骤的截图
- [ ] 收集了日志信息
- [ ] 总结了改进建议

---

**开始日期**: 2026-01-26  
**预计完成时间**: 2-3 小时  
**联系方式**: 查看 [ENTERTAINMENT_GROUP_QUICK_REFERENCE.md](ENTERTAINMENT_GROUP_QUICK_REFERENCE.md)
